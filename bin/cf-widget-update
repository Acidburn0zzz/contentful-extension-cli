#!/usr/bin/env node

'use strict';

var yargs = require('yargs');
var request = require('request');
var http = require('../lib/cli/http');
var update = require('../lib/cli/command/update');
var path = require('path');

let token = process.env.CONTENTFUL_MANAGEMENT_ACCESS_TOKEN;

if (!token) {
  console.error('CONTENTFUL_MANAGEMENT_ACCESS_TOKEN is undefined or empty');
  process.exit(1);
}

yargs
.reset()
.options({
  'space-id': {
    required: true,
    description: 'Id of a space in Contentful',
    type: 'string',
    requiresArg: true
  },
  'id': {
    description: 'Id of the widget to update',
    type: 'string',
    requiresArg: true,
  },
  'f': {
    description: 'Path to widget bundle',
    type: 'string',
    requiresArg: true
  },
  'u': {
    description: 'URL to widget bundle',
    type: 'string',
    requiresArg: true,
  },
  'v': {
    description: 'Current version of the widget',
    type: 'string',
    requiresArg: true,
  },
  'descriptor': {
    description: 'Path to a widget descriptor file',
    type: 'string',
    requiresArg: true
  },
  'host': {
    description: 'API host',
    type: 'string',
    requiresArg: true
  }
});

let argv = yargs.argv;
let options = {};

options.url = argv.u;
options.file = argv.f;
options.version = argv.v;
options.id = argv.id;
options.spaceId = argv.spaceId;
options.descriptor = argv.descriptor || './widget.json';
options.descriptor = path.resolve(process.cwd(), options.descriptor);

let context = {
  host: argv.host || 'https://api.contentful.com',
  token: token,
  request: request,
  http: http
};

update(options, context);
